<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>llm service - Map Action docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Map Action docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Welcom</a>
                            </li>
                            <li class="nav-item">
                                <a href="../install-run/" class="nav-link">Install and run</a>
                            </li>
                            <li class="nav-item">
                                <a href="../system-arch/" class="nav-link">System Arch</a>
                            </li>
                            <li class="nav-item">
                                <a href="../cnn/" class="nav-link">cnn service</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">llm service</a>
                            </li>
                            <li class="nav-item">
                                <a href="../celery/" class="nav-link">celery config and tasks</a>
                            </li>
                            <li class="nav-item">
                                <a href="../models/" class="nav-link">Pydantic model</a>
                            </li>
                            <li class="nav-item">
                                <a href="../contribution-guideline/" class="nav-link">contrubition guideline</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../cnn/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../celery/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#services.llm.gpt_3_5_turbo" class="nav-link">gpt_3_5_turbo</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#services.llm.gpt_3_5_turbo.chat_response" class="nav-link">chat_response</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#services.llm.gpt_3_5_turbo.display_chat_history" class="nav-link">display_chat_history</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#services.llm.gpt_3_5_turbo.generate_satellite_analysis" class="nav-link">generate_satellite_analysis</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#services.llm.gpt_3_5_turbo.get_assistant_response" class="nav-link">get_assistant_response</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#services.llm.gpt_3_5_turbo.get_response" class="nav-link">get_response</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="doc doc-object doc-module">



<a id="services.llm.gpt_3_5_turbo"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="services.llm.gpt_3_5_turbo.chat_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">chat_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">chat_history</span><span class="o">=</span><span class="p">[],</span> <span class="n">impact_area</span><span class="o">=</span><span class="s1">&#39;Non spécifié&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Processes a user's prompt to generate the assistant's response using GPT-4o-mini,
with context about the environmental incident.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prompt</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user's message to which the assistant should respond.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A JSON string containing context about the incident.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chat_history</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The existing chat history for this session.</p>
              </div>
            </td>
            <td>
                  <code>[]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>impact_area</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The area impacted by the incident.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Non spécifié&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The assistant's response.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="s1">&#39;{&quot;type_incident&quot;: &quot;Déforestation&quot;, &quot;analysis&quot;: &quot;La déforestation affecte la biodiversité locale.&quot;, &quot;piste_solution&quot;: &quot;Reforestation et éducation communautaire.&quot;}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Quels sont les impacts de la déforestation dans cette zone ?&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chat_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<span class="go">&#39;La déforestation affecte la biodiversité locale en réduisant les habitats naturels des espèces. Pour remédier à cela, la reforestation et l&#39;éducation communautaire sont des pistes de solution envisageables.&#39;</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">context</span> <span class="o">=</span> <span class="s1">&#39;{&quot;type_incident&quot;: &quot;Pollution de l&#39;</span><span class="n">eau</span><span class="s2">&quot;, &quot;</span><span class="n">analysis</span><span class="s2">&quot;: &quot;</span><span class="n">Les</span> <span class="n">rejets</span> <span class="n">industriels</span> <span class="n">ont</span> <span class="n">contaminé</span> <span class="n">la</span> <span class="n">rivière</span><span class="o">.</span><span class="s2">&quot;, &quot;</span><span class="n">piste_solution</span><span class="s2">&quot;: &quot;</span><span class="n">Installation</span> <span class="n">de</span> <span class="n">stations</span> <span class="n">de</span> <span class="n">traitement</span> <span class="n">des</span> <span class="n">eaux</span><span class="o">.</span><span class="s2">&quot;}&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Comment pouvons-nous améliorer la qualité de l&#39;eau ?&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chat_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<span class="go">&#39;Les rejets industriels ont contaminé la rivière. Pour améliorer la qualité de l&#39;eau, l&#39;installation de stations de traitement des eaux est recommandée.&#39;</span>
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>app/services/llm/gpt_3_5_turbo.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">chat_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">chat_history</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">impact_area</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Non spécifié&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a user&#39;s prompt to generate the assistant&#39;s response using GPT-4o-mini,</span>
<span class="sd">    with context about the environmental incident.</span>

<span class="sd">    Args:</span>
<span class="sd">        prompt (str): The user&#39;s message to which the assistant should respond.</span>
<span class="sd">        context (str): A JSON string containing context about the incident.</span>
<span class="sd">        chat_history (list): The existing chat history for this session.</span>
<span class="sd">        impact_area (str): The area impacted by the incident.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The assistant&#39;s response.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; context = &#39;{&quot;type_incident&quot;: &quot;Déforestation&quot;, &quot;analysis&quot;: &quot;La déforestation affecte la biodiversité locale.&quot;, &quot;piste_solution&quot;: &quot;Reforestation et éducation communautaire.&quot;}&#39;</span>
<span class="sd">        &gt;&gt;&gt; prompt = &quot;Quels sont les impacts de la déforestation dans cette zone ?&quot;</span>
<span class="sd">        &gt;&gt;&gt; chat_response(prompt, context)</span>
<span class="sd">        &#39;La déforestation affecte la biodiversité locale en réduisant les habitats naturels des espèces. Pour remédier à cela, la reforestation et l&#39;éducation communautaire sont des pistes de solution envisageables.&#39;</span>

<span class="sd">        &gt;&gt;&gt; context = &#39;{&quot;type_incident&quot;: &quot;Pollution de l&#39;eau&quot;, &quot;analysis&quot;: &quot;Les rejets industriels ont contaminé la rivière.&quot;, &quot;piste_solution&quot;: &quot;Installation de stations de traitement des eaux.&quot;}&#39;</span>
<span class="sd">        &gt;&gt;&gt; prompt = &quot;Comment pouvons-nous améliorer la qualité de l&#39;eau ?&quot;</span>
<span class="sd">        &gt;&gt;&gt; chat_response(prompt, context)</span>
<span class="sd">        &#39;Les rejets industriels ont contaminé la rivière. Pour améliorer la qualité de l&#39;eau, l&#39;installation de stations de traitement des eaux est recommandée.&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parse the context JSON string to extract details about the incident</span>
    <span class="n">context_obj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="n">incident_type</span> <span class="o">=</span> <span class="n">context_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type_incident&#39;</span><span class="p">,</span> <span class="s1">&#39;Inconnu&#39;</span><span class="p">)</span>
    <span class="n">analysis</span> <span class="o">=</span> <span class="n">context_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;analysis&#39;</span><span class="p">,</span> <span class="s1">&#39;Non spécifié&#39;</span><span class="p">)</span>
    <span class="n">piste_solution</span> <span class="o">=</span> <span class="n">context_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;piste_solution&#39;</span><span class="p">,</span> <span class="s1">&#39;Non spécifié&#39;</span><span class="p">)</span>
    <span class="n">impact_summary</span> <span class="o">=</span> <span class="n">context_obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;impact_summary&#39;</span><span class="p">,</span> <span class="s1">&#39;Non spécifié&#39;</span><span class="p">)</span>

    <span class="c1"># Update the system message to include the impact summary</span>
    <span class="n">system_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;system&gt;</span>
<span class="s2">        &lt;role&gt;assistant AI&lt;/role&gt;</span>
<span class="s2">        &lt;task&gt;analyse des incidents environnementaux&lt;/task&gt;</span>
<span class="s2">        &lt;location&gt;Mali&lt;/location&gt;</span>
<span class="s2">        &lt;incident&gt;</span>
<span class="s2">            &lt;type&gt;</span><span class="si">{</span><span class="n">incident_type</span><span class="si">}</span><span class="s2">&lt;/type&gt;</span>
<span class="s2">            &lt;analysis&gt;</span><span class="si">{</span><span class="n">analysis</span><span class="si">}</span><span class="s2">&lt;/analysis&gt;</span>
<span class="s2">            &lt;solution_tracks&gt;</span><span class="si">{</span><span class="n">piste_solution</span><span class="si">}</span><span class="s2">&lt;/solution_tracks&gt;</span>
<span class="s2">            &lt;impact_summary&gt;</span><span class="si">{</span><span class="n">impact_summary</span><span class="si">}</span><span class="s2">&lt;/impact_summary&gt;</span>
<span class="s2">        &lt;/incident&gt;</span>
<span class="s2">        &lt;instructions&gt;</span>
<span class="s2">            &lt;instruction&gt;Adaptez vos réponses au contexte spécifique de l&#39;incident.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Utilisez les informations de contexte pour enrichir vos explications.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Intégrez les données sur la zone d&#39;impact dans vos analyses lorsque c&#39;est pertinent.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Si la question dépasse le contexte fourni, mentionnez clairement que vous répondez de manière générale.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Priorisez les réponses concises et orientées sur la résolution du problème.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Ne déviez pas de la tâche principale et évitez les réponses non pertinentes.&lt;/instruction&gt;</span>
<span class="s2">            &lt;response_formatting&gt;</span>
<span class="s2">                &lt;formatting_rule&gt;Répondez de manière concise, avec une longueur de réponse idéale de 2 à 3 phrases.&lt;/formatting_rule&gt;</span>
<span class="s2">                &lt;formatting_rule&gt;Fournissez une réponse structurée : commencez par le problème principal, suivez avec la solution proposée.&lt;/formatting_rule&gt;</span>
<span class="s2">                &lt;formatting_rule&gt;Utilisez des mots simples et clairs, évitez le jargon technique inutile.&lt;/formatting_rule&gt;</span>
<span class="s2">                &lt;formatting_rule&gt;Donnez des informations essentielles en utilisant un langage direct et précis.&lt;/formatting_rule&gt;</span>
<span class="s2">                &lt;formatting_rule&gt;Si une recommandation est faite, assurez-vous qu&#39;elle est faisable et contextualisée.&lt;/formatting_rule&gt;</span>
<span class="s2">            &lt;/response_formatting&gt;</span>
<span class="s2">        &lt;/instructions&gt;</span>
<span class="s2">        &lt;examples&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Quels sont les impacts de la déforestation dans cette zone ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;La déforestation affecte la biodiversité locale en réduisant les habitats naturels des espèces. Pour remédier à cela, la reforestation et l&#39;éducation communautaire sont des pistes de solution envisageables.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Comment pouvons-nous améliorer la qualité de l&#39;eau ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;Les rejets industriels ont contaminé la rivière. Pour améliorer la qualité de l&#39;eau, l&#39;installation de stations de traitement des eaux est recommandée.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Que peut-on faire pour limiter l&#39;érosion des sols dans cette région ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;L&#39;érosion des sols est exacerbée par la déforestation et les pratiques agricoles non durables. Pour limiter l&#39;érosion, il est recommandé de pratiquer l&#39;agroforesterie, de planter des haies pour protéger les sols, et de promouvoir des techniques agricoles conservatrices.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Quelles sont les conséquences de la pollution de l&#39;air sur la santé publique ici ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;La pollution de l&#39;air, principalement due aux émissions industrielles et à la combustion de biomasse, a des effets négatifs sur la santé publique, notamment des problèmes respiratoires et cardiovasculaires. Pour atténuer ces impacts, il est essentiel de réduire les sources d&#39;émissions et de promouvoir des énergies plus propres.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Comment réduire l&#39;impact de la pollution plastique sur l&#39;environnement local ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;La pollution plastique peut être réduite en mettant en place des systèmes de collecte et de recyclage des déchets, en sensibilisant la population à la réduction de l&#39;utilisation du plastique, et en favorisant des alternatives biodégradables.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Quelles mesures peuvent être prises pour protéger la faune menacée dans cette région ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;Pour protéger la faune menacée, il est crucial de créer des zones protégées, de lutter contre le braconnage, et de promouvoir des pratiques agricoles respectueuses de l&#39;environnement qui minimisent la destruction des habitats naturels.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Parlons de musique !&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;Je comprends que vous souhaitez parler de musique. Toutefois, ma tâche principale est d&#39;analyser les incidents environnementaux. Si vous avez des questions sur un incident environnemental, je serais ravi de vous aider.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Avez-vous vu le dernier film populaire ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;Je ne suis pas programmé pour discuter des films récents. Mon rôle est de vous assister dans l&#39;analyse des incidents environnementaux. Revenons à ce sujet, si vous le voulez bien.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Quels sont les meilleurs restaurants ici ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;Je me concentre actuellement sur l&#39;analyse des incidents environnementaux. Pour toute question relative aux incidents ou à des pistes de solution, je suis prêt à vous aider.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">            &lt;example&gt;</span>
<span class="s2">                &lt;prompt&gt;Quelle est l&#39;étendue de la zone touchée par cet incident ?&lt;/prompt&gt;</span>
<span class="s2">                &lt;response&gt;L&#39;analyse des données satellitaires montre que la zone impactée par cet incident couvre environ </span><span class="si">{</span><span class="n">impact_area</span><span class="si">}</span><span class="s2"> kilomètres carrés. Cette information nous aide à mieux comprendre l&#39;ampleur du problème et à planifier des interventions appropriées.&lt;/response&gt;</span>
<span class="s2">            &lt;/example&gt;</span>
<span class="s2">        &lt;/examples&gt;</span>
<span class="s2">    &lt;/system&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="c1"># Build the list of messages for the conversation with roles defined for each message</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">system_message</span><span class="p">},</span>
    <span class="p">]</span> <span class="o">+</span> <span class="n">chat_history</span> <span class="o">+</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Get the assistant&#39;s response</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>  <span class="c1"># Ensure the model is available and correctly specified</span>
            <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># Reduce temperature for more focused and grounded responses</span>
            <span class="n">max_tokens</span><span class="o">=</span><span class="mi">1080</span><span class="p">,</span>
            <span class="n">top_p</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># Encourage more reliable answers by modifying top_p</span>
            <span class="n">frequency_penalty</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>  <span class="c1"># Penalize repetition for more diverse outputs</span>
            <span class="n">presence_penalty</span><span class="o">=</span><span class="mf">0.0</span>  <span class="c1"># Remove presence penalty to avoid deviation from the task</span>
        <span class="p">)</span>

        <span class="n">assistant_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
        <span class="k">return</span> <span class="n">assistant_response</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Désolé, je ne peux pas traiter votre demande pour le moment.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="services.llm.gpt_3_5_turbo.display_chat_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display_chat_history</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Prints the chat history to the console. Each message is displayed with the sender's role and content.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>messages</code>
            </td>
            <td>
                  <code>list of dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries where each dictionary represents a message in the chat history.
                     Each message has a 'role' key indicating who sent the message and a 'content' key with the message text.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/llm/gpt_3_5_turbo.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">display_chat_history</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the chat history to the console. Each message is displayed with the sender&#39;s role and content.</span>

<span class="sd">    Args:</span>
<span class="sd">        messages (list of dict): A list of dictionaries where each dictionary represents a message in the chat history.</span>
<span class="sd">                                 Each message has a &#39;role&#39; key indicating who sent the message and a &#39;content&#39; key with the message text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="services.llm.gpt_3_5_turbo.generate_satellite_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_satellite_analysis</span><span class="p">(</span><span class="n">ndvi_data</span><span class="p">,</span> <span class="n">ndwi_data</span><span class="p">,</span> <span class="n">landcover_data</span><span class="p">,</span> <span class="n">incident_type</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate a detailed analysis of satellite data for environmental incidents using LLM,
with proper markdown formatting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ndvi_data</code>
            </td>
            <td>
                  <code><span title="pd.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing NDVI data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ndwi_data</code>
            </td>
            <td>
                  <code><span title="pd.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing NDWI data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>landcover_data</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing land cover data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>incident_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of environmental incident</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detailed analysis of the satellite data, formatted in markdown</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/llm/gpt_3_5_turbo.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_satellite_analysis</span><span class="p">(</span><span class="n">ndvi_data</span><span class="p">,</span> <span class="n">ndwi_data</span><span class="p">,</span> <span class="n">landcover_data</span><span class="p">,</span> <span class="n">incident_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a detailed analysis of satellite data for environmental incidents using LLM,</span>
<span class="sd">    with proper markdown formatting.</span>

<span class="sd">    Args:</span>
<span class="sd">        ndvi_data (pd.DataFrame): DataFrame containing NDVI data</span>
<span class="sd">        ndwi_data (pd.DataFrame): DataFrame containing NDWI data</span>
<span class="sd">        landcover_data (dict): Dictionary containing land cover data</span>
<span class="sd">        incident_type (str): Type of environmental incident</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Detailed analysis of the satellite data, formatted in markdown</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Prepare the context</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;type_incident&quot;</span><span class="p">:</span> <span class="n">incident_type</span><span class="p">,</span>
        <span class="s2">&quot;ndvi_mean&quot;</span><span class="p">:</span> <span class="n">ndvi_data</span><span class="p">[</span><span class="s1">&#39;NDVI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;ndvi_trend&quot;</span><span class="p">:</span> <span class="s1">&#39;augmentation&#39;</span> <span class="k">if</span> <span class="n">ndvi_data</span><span class="p">[</span><span class="s1">&#39;NDVI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ndvi_data</span><span class="p">[</span><span class="s1">&#39;NDVI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;diminution&#39;</span><span class="p">,</span>
        <span class="s2">&quot;ndwi_mean&quot;</span><span class="p">:</span> <span class="n">ndwi_data</span><span class="p">[</span><span class="s1">&#39;NDWI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s2">&quot;ndwi_trend&quot;</span><span class="p">:</span> <span class="s1">&#39;augmentation&#39;</span> <span class="k">if</span> <span class="n">ndwi_data</span><span class="p">[</span><span class="s1">&#39;NDWI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ndwi_data</span><span class="p">[</span><span class="s1">&#39;NDWI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;diminution&#39;</span><span class="p">,</span>
        <span class="s2">&quot;dominant_cover&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">landcover_data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">landcover_data</span><span class="o">.</span><span class="n">get</span><span class="p">),</span>
        <span class="s2">&quot;dominant_cover_percentage&quot;</span><span class="p">:</span> <span class="n">landcover_data</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">landcover_data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">landcover_data</span><span class="o">.</span><span class="n">get</span><span class="p">)]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">landcover_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="p">}</span>

    <span class="n">system_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;system&gt;</span>
<span class="s2">        &lt;role&gt;assistant AI spécialisé en analyse environnementale&lt;/role&gt;</span>
<span class="s2">        &lt;task&gt;analyse des données satellitaires pour incidents environnementaux avec formatage markdown&lt;/task&gt;</span>
<span class="s2">        &lt;incident&gt;</span>
<span class="s2">            &lt;type&gt;</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;type_incident&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/type&gt;</span>
<span class="s2">            &lt;ndvi_data&gt;</span>
<span class="s2">                &lt;mean&gt;</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;ndvi_mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&lt;/mean&gt;</span>
<span class="s2">                &lt;trend&gt;</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;ndvi_trend&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/trend&gt;</span>
<span class="s2">            &lt;/ndvi_data&gt;</span>
<span class="s2">            &lt;ndwi_data&gt;</span>
<span class="s2">                &lt;mean&gt;</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;ndwi_mean&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&lt;/mean&gt;</span>
<span class="s2">                &lt;trend&gt;</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;ndwi_trend&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/trend&gt;</span>
<span class="s2">            &lt;/ndwi_data&gt;</span>
<span class="s2">            &lt;landcover&gt;</span>
<span class="s2">                &lt;dominant&gt;</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;dominant_cover&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/dominant&gt;</span>
<span class="s2">                &lt;percentage&gt;</span><span class="si">{</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;dominant_cover_percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&lt;/percentage&gt;</span>
<span class="s2">            &lt;/landcover&gt;</span>
<span class="s2">        &lt;/incident&gt;</span>
<span class="s2">        &lt;instructions&gt;</span>
<span class="s2">            &lt;instruction&gt;Analysez les données satellitaires fournies pour l&#39;incident environnemental spécifié.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Interprétez les tendances NDVI et NDWI en relation avec le type d&#39;incident.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Expliquez l&#39;importance de la couverture terrestre dominante dans le contexte de l&#39;incident.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Fournissez des insights sur les implications potentielles pour l&#39;environnement local.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Suggérez des pistes de solution ou des recommandations basées sur l&#39;analyse.&lt;/instruction&gt;</span>
<span class="s2">            &lt;instruction&gt;Formatez la réponse en utilisant la syntaxe markdown appropriée.&lt;/instruction&gt;</span>
<span class="s2">        &lt;/instructions&gt;</span>
<span class="s2">        &lt;response_formatting&gt;</span>
<span class="s2">            &lt;formatting_rule&gt;Utilisez &#39;**&#39; pour les titres principaux. ex: **Titre**&lt;/formatting_rule&gt;</span>
<span class="s2">            &lt;formatting_rule&gt;Utilisez &#39;***texte***&#39; pour mettre en gras et en italique les chiffres, pourcentages. ex: ***100***&lt;/formatting_rule&gt;</span>
<span class="s2">            &lt;formatting_rule&gt;Utilisez &#39;- &#39; au début d&#39;une ligne pour les listes à puces. ex: - item&lt;/formatting_rule&gt;</span>
<span class="s2">            &lt;formatting_rule&gt;Laissez une ligne vide entre chaque paragraphe pour bien espacer le contenu.&lt;/formatting_rule&gt;</span>
<span class="s2">            &lt;formatting_rule&gt;Structurez la réponse en sections claires avec des titres appropriés.&lt;/formatting_rule&gt;</span>
<span class="s2">            &lt;formatting_rule&gt;Utilisez des liens markdown si nécessaire : [texte du lien](URL)&lt;/formatting_rule&gt;</span>
<span class="s2">        &lt;/response_formatting&gt;</span>
<span class="s2">    &lt;/system&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">user_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Analysez les données satellitaires pour l&#39;incident de type &#39;</span><span class="si">{</span><span class="n">incident_type</span><span class="si">}</span><span class="s2">&#39; et fournissez un rapport détaillé formaté en markdown.&quot;</span>

    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">system_message</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">user_prompt</span><span class="p">}</span>
    <span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">max_tokens</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
            <span class="n">top_p</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
            <span class="n">frequency_penalty</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
            <span class="n">presence_penalty</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="p">)</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
        <span class="k">return</span> <span class="n">analysis</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred while generating satellite data analysis: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Désolé, une erreur s&#39;est produite lors de l&#39;analyse des données satellitaires.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="services.llm.gpt_3_5_turbo.get_assistant_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_assistant_response</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sends the current chat history to the OpenAI API to generate a response from the assistant using GPT-4o-mini.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>messages</code>
            </td>
            <td>
                  <code>list of dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current chat history as a list of message dictionaries.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The assistant's response as a string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>Exception</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prints an error message if the API call fails and returns a default error response.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/llm/gpt_3_5_turbo.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_assistant_response</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sends the current chat history to the OpenAI API to generate a response from the assistant using GPT-4o-mini.</span>

<span class="sd">    Args:</span>
<span class="sd">        messages (list of dict): The current chat history as a list of message dictionaries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The assistant&#39;s response as a string.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: Prints an error message if the API call fails and returns a default error response.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">completions</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>  <span class="c1"># The model version to use for generating responses</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">],</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">],</span>
            <span class="n">temperature</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Adjust the temperature if needed</span>
            <span class="n">max_tokens</span><span class="o">=</span><span class="mi">1080</span><span class="p">,</span>  <span class="c1"># Adjust as needed</span>
            <span class="n">top_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">frequency_penalty</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">presence_penalty</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">content</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Sorry, I can&#39;t process your request right now.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="services.llm.gpt_3_5_turbo.get_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Processes a user's prompt to generate and display the assistant's response using GPT-4o-mini.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prompt</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user's message to which the assistant should respond.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The assistant's response, which is also added to the chat history and displayed along with the rest of the conversation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/llm/gpt_3_5_turbo.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes a user&#39;s prompt to generate and display the assistant&#39;s response using GPT-4o-mini.</span>

<span class="sd">    Args:</span>
<span class="sd">        prompt (str): The user&#39;s message to which the assistant should respond.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The assistant&#39;s response, which is also added to the chat history and displayed along with the rest of the conversation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Add the user&#39;s message to the chat history</span>
    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">})</span>

    <span class="c1"># Get the assistant&#39;s response and add it to the chat history</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">get_assistant_response</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">response</span><span class="p">})</span>

    <span class="c1"># Display the updated chat history</span>
    <span class="n">display_chat_history</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
