<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>celery config and tasks - Map Action docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Map Action docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Welcom</a>
                            </li>
                            <li class="nav-item">
                                <a href="../install-run/" class="nav-link">Install and run</a>
                            </li>
                            <li class="nav-item">
                                <a href="../system-arch/" class="nav-link">System Arch</a>
                            </li>
                            <li class="nav-item">
                                <a href="../cnn/" class="nav-link">cnn service</a>
                            </li>
                            <li class="nav-item">
                                <a href="../llm/" class="nav-link">llm service</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">celery config and tasks</a>
                            </li>
                            <li class="nav-item">
                                <a href="../models/" class="nav-link">Pydantic model</a>
                            </li>
                            <li class="nav-item">
                                <a href="../contribution-guideline/" class="nav-link">contrubition guideline</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../llm/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../models/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#celery-configuration-and-tasks" class="nav-link">Celery Configuration and Tasks</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#celery-configuration" class="nav-link">Celery Configuration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#celery-tasks" class="nav-link">Celery Tasks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="celery-configuration-and-tasks">Celery Configuration and Tasks</h1>
<p>This document provides an overview of the Celery configuration and tasks used in the Map Action project. Celery is used for distributed task processing, allowing for efficient handling of asynchronous operations.</p>
<h2 id="celery-configuration">Celery Configuration</h2>
<p>The Celery application is configured in the <code>celery_config.py</code> file. It uses Redis as both the message broker and backend for task queueing and result storage. The configuration retrieves Redis connection details from environment variables.</p>
<h3 id="key-components">Key Components</h3>
<ul>
<li><strong>Redis</strong>: Used as the message broker and backend for Celery.</li>
<li><strong>Environment Variables</strong>: <code>REDIS_HOST</code>, <code>REDIS_PORT</code>, <code>REDIS_USERNAME</code>, <code>REDIS_PASSWORD</code>, and <code>REDIS_URL</code> are used to configure the Redis connection.</li>
</ul>
<h2 id="celery-tasks">Celery Tasks</h2>
<p>The Celery tasks are defined in the <code>celery_task.py</code> file. These tasks perform various operations, including image prediction, fetching contextual information, and analyzing incident zones.</p>
<h3 id="tasks-overview">Tasks Overview</h3>
<ul>
<li><strong>perform_prediction</strong>: Uses a convolutional neural network to predict the content of an image and calculate classification probabilities.</li>
<li><strong>fetch_contextual_information</strong>: Fetches contextual information based on the prediction, sensitive structures, and geographic zone.</li>
<li><strong>analyze_incident_zone</strong>: Analyzes the incident zone using satellite data, generating analysis results and plot data.</li>
</ul>
<h3 id="task-details">Task Details</h3>
<ul>
<li>
<p><strong>perform_prediction</strong>:</p>
<ul>
<li><strong>Args</strong>: <code>image</code> (bytes) - The image data to be processed.</li>
<li><strong>Returns</strong>: A tuple containing the predicted classification and probabilities.</li>
</ul>
</li>
<li>
<p><strong>fetch_contextual_information</strong>:</p>
<ul>
<li><strong>Args</strong>: <code>prediction</code> (str), <code>sensitive_structures</code> (list), <code>zone</code> (str).</li>
<li><strong>Returns</strong>: A tuple containing analysis and piste_solution, both formatted in markdown.</li>
</ul>
</li>
<li>
<p><strong>analyze_incident_zone</strong>:</p>
<ul>
<li><strong>Args</strong>: <code>lat</code> (float), <code>lon</code> (float), <code>incident_location</code> (str), <code>incident_type</code> (str), <code>start_date</code> (str), <code>end_date</code> (str).</li>
<li><strong>Returns</strong>: A dictionary containing analysis results and plot data.</li>
</ul>
</li>
</ul>
<p>For more detailed information on each task, refer to the <code>celery_task.py</code> file in the <code>app/services/celery/</code> directory.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
